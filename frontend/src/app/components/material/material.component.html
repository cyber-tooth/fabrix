<div class="container d-flex flex-column sticky-footer-wrapper min-vh-100 ">
  <div class="row">
    <div class="col-md-2" style="border-right: #777777" *ngIf="categoriesAreFetched">
      <div class="btn-group btn-block dropdown" dropdown container="body" [insideClick]="true"
           *ngFor="let mainCategory of mainCategories">
        <button id="button-nested" dropdownToggle type="button" class="btn btn-secondary dropdown-toggle"
                data-toggle="dropdown-grid" type="button" aria-expanded="false" aria-haspopup="true">
          {{mainCategory.categoryName}} <span class="caret"></span>
        </button>
        <div id="dropdown-nested" *dropdownMenu class="dropdown-menu"
             role="menu" aria-labelledby="button-nested">
          <span *ngIf="mainCategory.children as list">
              <ng-template #recursiveList let-list>
                <div role="menuitem" style="min-width: 15rem" dropdown [autoClose]="true" [insideClick]="true"
                     triggers="mouseover" placement="right"
                     container="body" *ngFor="let item of list; let index = index">
                      <div *ngIf="index!=0" class="dropdown-divider"></div>

                      <a *ngIf="item.children && item.children.length > 0 else filter" dropdownToggle
                         class="dropdown-item dropdown-toggle"
                         (click)="false"> <span>{{item.categoryName}}</span></a>
                     <ng-template #filter>
                       <a *ngIf="!item.hasDegree else dgreeFilter"
                          [ngClass]="item.selected?  'active' : ''" (click)="select(item)"
                          style="min-width: 25rem;" class="dropdown-item">
                           {{item.categoryName}}
                        </a>
                     </ng-template>
                     <ng-template #dgreeFilter>
                        <labe style="min-width: 25rem" class="dropdown-item">
                           {{item.categoryName}}
                        </labe>
                       <div class="p-2">
                         <ngx-slider [(value)]="item.minDegree" [(highValue)]="item.maxDegree"
                                     (valueChange)="setValues(item)"
                                     [options]="Weightoptions"></ngx-slider>
                       </div>
                     </ng-template>
                      <span *ngIf="item.children.length > 0">
                        <div *dropdownMenu class="dropdown-menu  ml-1" role="menu">
                          <div role="menuitem">
                             <ng-container
                               *ngTemplateOutlet="recursiveList; context:{ $implicit: item.children }"></ng-container>
                          </div>
                        </div>
                      </span>
                    </div>
          </ng-template>
              <ng-container
                *ngTemplateOutlet="recursiveList; context: { $implicit: mainCategory.children }"></ng-container>
          </span>
        </div>
      </div>
    </div>
    <ng-container *ngTemplateOutlet="materials.length>0 ? materialsExists : noMaterials;">
    </ng-container>
  </div>
  <div class="row mt-2 justify-content-between align-items-center">
    <pagination-controls
      previousLabel="Prev"
      nextLabel="Next"
      responsive="true"
      (pageChange)="handlePageChange($event)"
    ></pagination-controls>
  </div>
</div>

<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{selectedMaterial.name}}</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-md-6 border-right">
        <div id="carouselExampleIndicators" *ngFor="let im of selectedMaterial.images; let i=index; let lastCall=last"
             class="carousel slide my-4" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#carouselExampleIndicators" data-slide-to="{{i}}" class="active"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to=""></li>
          </ol>
          <div class="carousel-inner" role="listbox">
            <div class="fill carousel-item active">
              <img class="d-block img-fluid" src="{{api+im.url}}" alt="{{i}}Slide">
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <ul>
          <span *ngIf="selectedMaterial.children as list">
            <ng-template #recursiveList let-list>
            <li *ngFor="let item of list">
              {{item.name }} <span *ngIf="item.degree"> {{item.degree}}
                  <span *ngIf="item.id == 46"> g/mÂ²</span>
                  <span *ngIf="item.id == 59"> mm</span>
                  <span *ngIf="item.id != 59 && item.id != 46"> %</span>
              </span>
              <ul *ngIf="item.children && item.children.length > 0">
                <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: item.children }"></ng-container>
              </ul>
            </li>
          </ng-template>
          <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: list }"></ng-container>
          </span>
        </ul>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #materialsExists>
  <div class="col-md-10">
    <div class="row">
      <div class="col-lg-3 col-md-4 mb-3"
           *ngFor="let material of materials | paginate:{itemsPerPage: limit,currentPage: offset,totalItems: count}; let i=index">
        <div class="card" (click)="openModal(template, material)" style="cursor: pointer">
          <img *ngIf="material.images[0]" class="card-img-top" [src]="api+material.images[0].url" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{material.name}}</h5>
            <p class="card-text"></p>
            <p class="card-text"><small class="text-muted">Last updated {{material.updatedAt | date}}</small></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #noMaterials class="text-center">
  <div class="col-md-10 text-center justify-content-center">
      <h3>No Results found</h3>
    </div>
</ng-template>

